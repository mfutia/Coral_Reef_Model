---
title: "BIOL 381_ Coral Reef Model"
author: "Gavin Briske, Matt Futia, Liza Morse"
date: "10/14/2020"
output: pdf_document
---

<<<<<<< HEAD
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

*Part A*

![Individual flow diagram representing societal factors that influence the willingness of the public to participate in coral reef conservation.](C:/Users/mttft/Desktop/UVM/UVM Courses/Quant Reasoning/Coral_Reef_Model/SimpleModel_Futia.png)


![Team flow diagram representing societal factors that influence the willingness of the public to participate in coral reef conservation.](C:/Users/mttft/Desktop/UVM/UVM Courses/Quant Reasoning/Coral_Reef_Model/Case Study Flow Chart.png)



```{r}
require(deSolve)
Time = seq(0,50,0.1)
# Scenario 1: C = 0.8, P = 0.5
Pars = c(kappa = 1.014, j = 1.68, sigma = 0.5, phi = 0.2, C = 0.8, P = 0.5)

social_model <- function(Time, State, Pars) {
  with(as.list(c(State, Pars)), {
    dX <- kappa*X*(1 - X)*(-1 + j*(1 - C) - sigma*P*(1 - X) + phi*(2*X - 1))
    list(c(dX))
  })
}

State = c(X = 0.2)
out.2 = data.frame(ode(y = State, times = Time, func = social_model, parms = Pars))
out.2$Initial = 0.2

State = c(X = 0.5)
out.5 = data.frame(ode(y = State, times = Time, func = social_model, parms = Pars))
out.5$Initial = 0.5


State = c(X = 0.8)
out.8 = data.frame(ode(y = State, times = Time, func = social_model, parms = Pars))
out.8$Initial = 0.8


out = rbind(out.2, out.5, out.8)

# Scenario 2: C = 0.8, P = 0.2
Pars2 = c(kappa = 1.014, j = 1.68, sigma = 0.5, phi = 0.2, C = 0.8, P = 0.2)

social_model2 <- function(Time, State, Pars2) {
  with(as.list(c(State, Pars2)), {
    dX <- kappa*X*(1 - X)*(-1 + j*(1 - C) - sigma*P*(1 - X) + phi*(2*X - 1))
    list(c(dX))
  })
}

State = c(X = 0.2)
out.2 = data.frame(ode(y = State, times = Time, func = social_model2, parms = Pars2))
out.2$Initial = 0.2

State = c(X = 0.5)
out.5 = data.frame(ode(y = State, times = Time, func = social_model2, parms = Pars2))
out.5$Initial = 0.5


State = c(X = 0.8)
out.8 = data.frame(ode(y = State, times = Time, func = social_model2, parms = Pars2))
out.8$Initial = 0.8


out2 = rbind(out.2, out.5, out.8)

# Scenario 3: C = 0.8, P = 0.5
Pars3 = c(kappa = 1.014, j = 1.68, sigma = 0.5, phi = 0.2, C = 0.4, P = 0.5)

social_model3 <- function(Time, State, Pars3) {
  with(as.list(c(State, Pars3)), {
    dX <- kappa*X*(1 - X)*(-1 + j*(1 - C) - sigma*P*(1 - X) + phi*(2*X - 1))
    list(c(dX))
  })
}

State = c(X = 0.2)
out.2 = data.frame(ode(y = State, times = Time, func = social_model3, parms = Pars3))
out.2$Initial = 0.2

State = c(X = 0.5)
out.5 = data.frame(ode(y = State, times = Time, func = social_model3, parms = Pars3))
out.5$Initial = 0.5


State = c(X = 0.8)
out.8 = data.frame(ode(y = State, times = Time, func = social_model3, parms = Pars3))
out.8$Initial = 0.8

out3 = rbind(out.2, out.5, out.8)

p1 = ggplot(out, aes(x = time, y = X)) +
  geom_line(out, mapping = aes(time, X, color = as.character(Initial)), size = 1.5) +
  labs(x = 'Time', y = "", color = "Initial proportion") +
  theme_classic() +
  theme(legend.position = c(.8, .8)) +
  scale_x_continuous(expand = c(0,0)) +
  annotate("text", x = 4, y=.9, label = "Scenario 1")

p2 = ggplot(out2, aes(x = time, y = X)) +
  geom_line(out2, mapping = aes(time, X, color = as.character(Initial)), size = 1.5) +
  labs(x = 'Time', y = "Proportion of population willing to participate in conservation", color = "Initial proportion") +
  theme_classic() +
  theme(legend.position = c(.8, .8)) +
  scale_x_continuous(expand = c(0,0)) +
  annotate("text", x = 4, y=.9, label = "Scenario 2")

p3 = ggplot(out3, aes(x = time, y = X)) +
  geom_line(out3, mapping = aes(time, X, color = as.character(Initial)), size = 1.5) +
  labs(x = 'Time', y = "", color = "Initial proportion") +
  theme_classic() +
  theme(legend.position = c(.8, .8)) +
  scale_x_continuous(expand = c(0,0)) +
  annotate("text", x = 4, y=.9, label = "Scenario 3")
```


```{r, figures-side, fig.show = "hold", out.width = "75%", fig.cap = "Proportion of poeple willing to participate in coral reef conservation over time with three different initial starting proportions (0.2, 0.5, and 0.8) across three scenarios. Scenarios differ based on live coral cover (Scenario 1: 0.8, Scenario 2: 0.8, Scenario 3: 0.4) and parrotfish abundance (Scenario 1: 0.5, Scenario 2: 0.2, Scenario 3: 0.5).", fig.align = "center"}
par(mfcol = c(3,1))
p1
p2
p3
```


```{r}
Table1 = data.frame(matrix(nrow = 6, ncol = 3))
colnames(Table1) = c("Parameter", "Description", "Value")
Table1$Parameter = c('\u03BA', 'j', 'C', 'P', '\u03c3', '\u03A6')
Table1$Description = c("Interactions with others", "Sensitivity to dead coral", "Live coral cover", "Parrotfish abundance", "Fishing pressue", "Public pressure")
Table1$Value = c("1.014/y", "1.68", "a", "b", "0.5", "0.2")
```

```{r comment = '', echo = F, results = 'asis'}
knitr::kable(Table1, caption = "Model parameter symbols, description, and estimated parameter values.")
``` 

Based on the three scenarios, long-term results from this model result in either complete or absent willingness to participate in coral reef conservation. The ultimate outcome of the model appears to be dependent on amount of live coral and the initial proportion of individuals willing to participate; high initial support for conservation and low abundance of live coral results in increased support for conservation.

*Part B*

![Team flow diagram representing ecological and societal factors that influence coral reef conservation.](C:/Users/mttft/Desktop/UVM/UVM Courses/Quant Reasoning/Coral_Reef_Model/Eco_SocioFlowChart.png)

By including both the ecological and social components in our model, we predict the model will be ________ We anticipate that live coral will be the most important parameter in determining the overall system dynamics because it seems to be the only term that all variables are directly dependent on.

```{r}
coupled_model = function(Time, State, Pars) {
  with(as.list(c(State, Pars)), {
    dM =  a*M*C - (P*M)/(M+T) + gamma*M*T
    dC =  r*T*C - d*C - a*M*C
    dT = (P*M)/(M+T) - gamma*M*T - r*T*C + d*C
    dP = s*P*(1 - P/C) - sigma*P*(1 - X)
    dX = kappa*X*(1 - X)*(-1 + j*(1 - C) - sigma*P*(1 - X) + phi*(2*X - 1))
    return(list(c(dM,dC,dT,dP,dX)))  
  })
}

pars = c(a = 0.1, gamma = 0.8, r = 1.0, d = 0.44, s = 0.49, sigma = 0.5, kappa= 1.014, j=1.68, sigma = 0.5, phi = 0.2)


yini = c(M = 0.05, C = 0.9, T = 0.05, P = 0.4, X = 0.5)
times = seq(0, 100, by = 0.1)
out_total = data.frame(ode(yini, times, coupled_model, pars))


final = melt(out_total, id.vars = "time")


final1 = filter(final, variable != "X")
final2 = filter(final, variable == "X")

par(mfrow=c(1,2))

f1 = ggplot(final1, aes(x = time, y = value)) +
  geom_line(final1, mapping = aes(time, value, color = variable)) +
  theme_classic() +
  theme(legend.position = c(.8, .75)) +
  ylab("Proportional Cover") +
  scale_x_continuous(expand = c(0,0))

f2 = ggplot(final2, aes(x = time, y = value)) +
  geom_line(final2, mapping = aes(time, value, color = variable)) +
  theme_classic() +
  ylab("Fraction that are conservationists") +
  theme(legend.position = "none") +
  scale_x_continuous(expand = c(0,0))
```

=======
dx/dt = Kx(1−x)(−1 +j(1−C) − σP(1−x) +φ(2x−1))

*Defined Variables (description in table)*

x = fraction of individuals (humans) in the population willing to participate in coral conservation
C = live coral cover 
P = Parrotfish abundance (try different values)

*Undefined Variables (description not in table)*

K = human growth rate per year
j = coral growth rate per year
σ = Parrotfish growth rate per year
φ = unknown interaction term

```{r}
#parameters
K = 1.014
j = 1.68
σ = 0.5
φ = 0.2

#equation - change in willingness to participate in coral conservaiton
change_wtp <- Kx(1−x)(−1 +j(1−C) − σP(1−x) +φ(2x−1))


```

Equilibrium points occur when dx/dt = 0. 

dx/dt = 0 at 3 points:

1) when x = 0

In this case, none of population supports coral reef conservation.

2) when (1-x) = 0 aka x = 1

In this case, all of population supports coral reef conservation.

3) When (−1 +j(1−C) − σP(1−x) +φ(2x−1)) = 0

-1 + j - jC - σP + σPx + 2φx - φ = 0

j - jC - σP + σPx + 2φx = 1

Not sure what this means...

